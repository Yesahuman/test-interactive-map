<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>OneMap Postal Code Interactive Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #map { height: 400px; width: 100%; margin-top: 20px; }
    input, button { font-size: 16px; padding: 6px; }
  </style>
</head>
<body>
  <h1>OneMap Postal Code Interactive Map</h1>
  <input id="postal" placeholder="Enter postal code" />
  <button onclick="searchPostal()">Search</button>
  <div id="address" style="margin-top: 10px; font-weight: bold;"></div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([1.3521, 103.8198], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    let marker;

    const token = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo4MTAxLCJmb3JldmVyIjpmYWxzZSwiaXNzIjoiT25lTWFwIiwiaWF0IjoxNzU0NTc2MTA1LCJuYmYiOjE3NTQ1NzYxMDUsImV4cCI6MTc1NDgzNTMwNSwianRpIjoiOGI1MTE3ODUtNTQyNy00MTAyLWE0NDUtZjE5ZjEzZjBiMDE0In0.npWcZpKMbpuW539fNbSVU_r9dAK9sPmBZIBh89DbfrdFHUZmCWyPxL7KjuRM0KVqdbOT1ZWEwA6YtquGjqRCekZENawp82fWnEpYzq_ynFDo5vJg-3y6yRAgVBfdhqzGYWzkmGZMPAhuq4kbtd705_bqBhw9kyTzeXQ2qRDbomrn8DLv75_fJRO-VDw_u6lpUPBIo2Jdglq8NY4ltYxWFrL2hxW2cdWxptFn12882pLA5L-JWPBDroL0RvUvpe8iU5q8YdvqgQIfmPop9-n7f7jjIY7t_StglFIKpdn1v6Fcu2NjSf7u2WFdCkaHaEfM8mp5ziv4EL_T2tnCWJIsSA';

    function searchPostal() {
      const postal = document.getElementById('postal').value.trim();
      if (!postal) {
        alert('Please enter a postal code.');
        return;
      }

      const url = `https://developers.onemap.sg/commonapi/search?searchVal=${postal}&returnGeom=Y&getAddrDetails=Y&token=${token}`;

      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.json();
        })
        .then(data => {
          if (data.results && data.results.length > 0) {
            const res = data.results[0];
            document.getElementById('address').textContent = res.ADDRESS;

            const lat = parseFloat(res.LATITUDE);
            const lon = parseFloat(res.LONGITUDE);

            if (marker) map.removeLayer(marker);
            marker = L.marker([lat, lon]).addTo(map).bindPopup(res.ADDRESS).openPopup();
            map.setView([lat, lon], 17);
          } else {
            document.getElementById('address').textContent = 'No results found.';
          }
        })
        .catch(err => {
          document.getElementById('address').textContent = 'Error fetching data.';
          console.error('Fetch error:', err);
        });
    }
  </script>
</body>
</html>
